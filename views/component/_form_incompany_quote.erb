<form id="incompany-quote-form" action="/<%=session[:locale] || 'es'%>/send-mail" method="post" class="needs-validation" novalidate>
  <div class="row">
    <div class="mb-3 col-xs-12">
      <label class="form-label"><%= t("contact-us-form.name-input.label") %></label>
      <input
        type="text"
        class="form-control"
        name="name"
        id="incompany-name-input"
        required>
      <div class="invalid-feedback">
        <%= t("contact-us-form.name-input.error-message") %>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="mb-3 col-xs-12 col-md-6">
      <label class="form-label"><%= t("contact-us-form.email-input.label") %></label>
      <input
        type="email"
        class="form-control"
        name="email"
        id="incompany-email-input"
        required>
      <div class="invalid-feedback">
        <%= t("contact-us-form.email-input.error-message") %>
      </div>
    </div>
    <div class="mb-3 col-xs-12 col-md-6">
      <label class="form-label"><%= t("contact-us-form.company-input.label") %></label>
      <input
        type="text"
        class="form-control"
        id="incompany-company-input"
        name="company">
    </div>
  </div>

  <!-- In-Company Specific Fields -->
  <div class="mb-3">
    <label class="form-label"><%= t("incompany_quote_form.location_label") %></label>
    <div class="form-check">
      <input
        class="form-check-input"
        type="radio"
        name="location"
        id="location-online"
        value="online"
        checked>
      <label class="form-check-label" for="location-online">
        <%= t("incompany_quote_form.location_online") %>
      </label>
    </div>
    <div class="form-check">
      <input
        class="form-check-input"
        type="radio"
        name="location"
        id="location-onsite"
        value="presencial">
      <label class="form-check-label" for="location-onsite">
        <%= t("incompany_quote_form.location_onsite") %>
      </label>
    </div>
  </div>

  <div class="mb-3" id="where-field" style="display: none;">
    <label class="form-label"><%= t("incompany_quote_form.where_label") %></label>
    <input
      type="text"
      class="form-control"
      name="where"
      id="incompany-where-input"
      placeholder="<%= t('incompany_quote_form.where_placeholder') %>">
    <div class="invalid-feedback">
      <%= t("incompany_quote_form.where_error") %>
    </div>
  </div>

  <div class="row">
    <div class="mb-3 col-xs-12 col-md-6">
      <label class="form-label"><%= t("incompany_quote_form.when_label") %></label>
      <input
        type="month"
        class="form-control"
        name="when"
        id="incompany-when-input"
        required>
      <div class="invalid-feedback">
        <%= t("incompany_quote_form.when_error") %>
      </div>
    </div>
    <div class="mb-3 col-xs-12 col-md-6">
      <label class="form-label"><%= t("incompany_quote_form.attendees_label") %></label>
      <input
        type="number"
        class="form-control"
        name="attendees"
        id="incompany-attendees-input"
        min="8"
        required>
      <div id="attendeesHelp" class="form-text"><%= t("incompany_quote_form.attendees_help") %></div>
      <div class="invalid-feedback">
        <%= t("incompany_quote_form.attendees_error") %>
      </div>
    </div>
  </div>

  <div id="recaptcha-placeholder" class="mb-3"></div>

  <input type="hidden" id="incompany-input-context" name="context" value="<%= request.path_info %>">
  <input type="hidden" name="form_type" value="incompany_quote">

  <div class="btn-center-container">
    <button type="submit"
            id="incompany-submit"
            class="btn my-primary-button"
            value="Submit"
            disabled
    >
      <%= t("incompany_quote_form.button_text") %></button>
  </div>
</form>

<script>
  // Conditional field display for location
  document.addEventListener('DOMContentLoaded', function() {
    const locationOnline = document.getElementById('location-online');
    const locationOnsite = document.getElementById('location-onsite');
    const whereField = document.getElementById('where-field');
    const whereInput = document.getElementById('incompany-where-input');

    function toggleWhereField() {
      if (locationOnsite.checked) {
        whereField.style.display = 'block';
        whereInput.setAttribute('required', '');
      } else {
        whereField.style.display = 'none';
        whereInput.removeAttribute('required');
        whereInput.value = '';
      }
    }

    locationOnline.addEventListener('change', toggleWhereField);
    locationOnsite.addEventListener('change', toggleWhereField);

    // Setup reCAPTCHA when modal opens
    var modalElement = document.getElementById('incompany-quote-modal');
    modalElement.addEventListener('shown.bs.modal', function () {
      loadReCaptcha('incompany-quote-form');
    });

    // Form validation
    var form = document.getElementById('incompany-quote-form');
    form.addEventListener('submit', function (event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
</script>

on:
  push:
    branches: [ develop, master]
  pull_request:
    branches: [ develop, master]

jobs:
  CI:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up Ruby
      # automatic versioning https://github.com/ruby/setup-ruby#versioning):
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: 2.6.7
    - name: Install curb
      run: gem install curb -v '0.9.10'
    - name: Install dependencies
      run: bundle install
    - name: Run tests
      run: rspec
    - name: Run acceptance tests
      run: cucumber
#    - name: Check rubycritic
#      run: rubycritic -f html --no-browser
    # - name: update index
    #   run: |
    #     cat > tmp/rubycritic/index.md <<EOL
    #     ---
    #       permalink: /overview.html
    #     ---
    #     EOL
    # - name: Deploy to Heroku
    #   if: success()
    #   uses: crazy-max/ghaction-github-pages@v2
    #   with:
    #     target_branch: gh-pages
    #     build_dir: tmp/rubycritic/
    #   env:
    #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#     - name: Discord notification
#       if: ${{ success() }}
#       uses: Ilshidur/action-discord@759f6ea4dc493b8bd1bb35ae7fbd7ae10fcea129
#       with:
#         args: 'The project {{ EVENT_PAYLOAD.repository.full_name }} looks ok!!.'
#     - name: The job has failed
#       if: ${{ failure() }}
#       uses: Ilshidur/action-discord@759f6ea4dc493b8bd1bb35ae7fbd7ae10fcea129
#       with:
#         args: 'UPS something fails in {{ EVENT_PAYLOAD.repository.full_name }}, please check the IC flow!.'
# Â© 2021 GitHub, Inc.
<%
  #solucion completamente temporal
  courses = []
  categories = []
  @categories.each{|e|
    categories.push(e.name)
    e.event_types.each{|course|
      date = defined?(course.date) ? format_date_range(course.date, course.finish_date, 'es') : t('home2022.home_courses.no_date')
      is_open = defined?(course.date)
      is_incompany = true
      courses.push(
      {
        title: course.name, duration: course.duration, subtitle: course.subtitle,
        cover: course.cover, uri_path: course.uri_path, is_open: is_open, is_incompany: is_incompany, is_elearning: false,
        category: e.name, date: date, url: course.uri_path,
        country: 'OL', certified: (2 if course.is_sa_cert).to_i +
        (1 if course.is_kleer_cert).to_i,
      })
    }
  }

  @academy.each{|e|
    courses.push(
      {
        title: e['es']['title'], duration: e['es']['duration'], subtitle: e['es']['subtitle'],
        cover: e['es']['cover'], uri_path: e['es']['url'], is_open: false, is_incompany: false, is_elearning: true,
        category: e['es']['category'], date: 'Asincrono', certified: 1
      }
    )
  }

%>

<section id="courses" class="p-5 mt-4">
  <div class='container'>
    <h4 class="text-center m-4 last-courses__tittle">
      Capacitaci√≥n personal y empresarial en agilidad
    </h4>
    <div class="courses-filters">
      <div class="dropdown d-flex courses-filters__drop">
        <button class="btn btn-secondary dropdown-toggle " type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
          Tipo de evento
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
          <li>
            <div class="form-check">
              <input class="form-check-input check-delivery" type="checkbox" value="" id="flexCheckDefault">
              <label class="form-check-label" for="flexCheckDefault">
                Abiertos
              </label>
            </div>
          </li>
          <li>
            <div class="form-check">
              <input class="form-check-input check-delivery" type="checkbox" value="" id="flexCheckDefault">
              <label class="form-check-label" for="flexCheckDefault">
                In company
              </label>
            </div>
          </li>
          <li>
            <div class="form-check">
              <input class="form-check-input check-delivery" type="checkbox" value="" id="flexCheckDefault">
              <label class="form-check-label" for="flexCheckDefault">
                E-learning
              </label>
            </div>
          </li>
        </ul>
      </div>
      <% categories.each do |category| %>
        <button
          class="courses-filters__tag courses-filters__tag--selected"
          onclick="filterByCategory('<%= category %>')"
        ><%= category %></button>
      <% end %>

    </div>
    <div class='row mt-5' id="courses-container">
      <% courses.each do |course|
        @course = course
      %>
        <div class='col-3 p-2' id="<%= "#{course[:category]}--#{course[:title]}"%>">
          <%= erb :'component/_course_card' %>
        </div>
      <% end%>
    </div>
<!--    <div class="btn-center-container mt-5">-->
<!--      <a class="btn my-primary-button">-->
        <%#= t('home2022.home_courses.button.title') %>
<!--      </a>-->
<!--    </div>-->
  </div>
</section>

<script>
  const container = document.getElementById('courses-container')
  const courseCards = container.children
  const courseCardsObjects = Array.from(container.children).map((element) => {
      const id = element.id.split('--')[0]
      const name = element.id.split('--')[1]
      return {
          element: element,
          category: id,
          name: name
      }
  })

  let categoryButtons = courseCardsObjects.map(card => card.id)
  categoryButtons = document.getElementsByClassName('courses-filters__tag')
  categoryButtons = Array.from(categoryButtons).map(category => {
      return{
          element: category,
          name: category.outerText
      }
  })

  let deliveryChecks = Array.from(document.getElementsByClassName('check-delivery'))
  console.log(deliveryChecks)

  let actualFilters = categoryButtons.map(category => category.name)

  const filterByCategory = (category) => {
    if(actualFilters.includes(category)){
        actualFilters = actualFilters.filter(item => item !== category)
    }else{
        actualFilters.push(category)
    }
    visualFilters()
  }

  const visualFilters = () => {
      for (let card of courseCardsObjects){
          if(actualFilters.includes(card.category)){
              card.element.classList.remove('hidden-element')
          }else{
              card.element.classList.add('hidden-element')
          }
      }

      for(let button of categoryButtons){
          if(actualFilters.includes(button.name)){
              button.element.classList.add('courses-filters__tag--selected')
              button.element.classList.remove('courses-filters__tag--unselected')
          }else{
              button.element.classList.remove('courses-filters__tag--selected')
              button.element.classList.add('courses-filters__tag--unselected')
          }
      }
  }

  visualFilters()



</script>
